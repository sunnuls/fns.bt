# üîÑ –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—é –¥–æ –≤–µ—Ä—Å–∏–∏ 2.0

## üéâ –ß—Ç–æ –Ω–æ–≤–æ–≥–æ

–í–µ—Ä—Å–∏—è 2.0 –≤–∫–ª—é—á–∞–µ—Ç —Ä–µ–≤–æ–ª—é—Ü–∏–æ–Ω–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è –∫–∞—á–µ—Å—Ç–≤–∞ –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏:

- ‚úÖ **–ö–∞—á–µ—Å—Ç–≤–æ –≤–∏–¥–µ–æ 11/10** - —É–≤–µ–ª–∏—á–µ–Ω—ã —à–∞–≥–∏ (40) –∏ FPS (24)
- ‚úÖ **–°–∫–æ—Ä–æ—Å—Ç—å +50%** - xformers, VAE slicing, TF32
- ‚úÖ **–ü–æ—Å—Ç–æ–±—Ä–∞–±–æ—Ç–∫–∞** - —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è —à—É–º–æ–≤, —É–ª—É—á—à–µ–Ω–∏–µ —Ä–µ–∑–∫–æ—Å—Ç–∏
- ‚úÖ **Docker –ø–æ–¥–¥–µ—Ä–∂–∫–∞** - –ª–µ–≥–∫–∏–π –¥–µ–ø–ª–æ–π –Ω–∞ –æ–±–ª–∞–∫–æ
- ‚úÖ **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è VRAM** - —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ GPU —Å 16GB+

## üìã –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—é

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ß–∏—Å—Ç–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ (–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```bash
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ç–µ–∫—É—â–∏–µ –ø—Ä–æ—Ü–µ—Å—Å—ã
# –í PowerShell –Ω–∞ Windows:
taskkill /F /IM python.exe

# –°–æ–∑–¥–∞—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é
cd c:\fns_bot
xcopy fanslymotion fanslymotion_backup /E /I

# –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–¥ (git pull –∏–ª–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª—ã)
cd fanslymotion
git pull origin main

# –û–±–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
pip install -r requirements.txt --upgrade

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å xformers (–∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏!)
pip install xformers==0.0.23

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—É—é –≤–µ—Ä—Å–∏—é
.\start_all.ps1
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Docker

```bash
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
docker-compose down

# –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–¥
git pull origin main

# –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –æ–±—Ä–∞–∑—ã
docker-compose build --no-cache

# –ó–∞–ø—É—Å—Ç–∏—Ç—å
docker-compose up -d

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
docker-compose logs -f
```

### –í–∞—Ä–∏–∞–Ω—Ç 3: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–∞ —É–¥–∞–ª–µ–Ω–Ω–æ–º —Å–µ—Ä–≤–µ—Ä–µ

```bash
# –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –ø–æ SSH
ssh root@your-server

# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–µ—Ä–≤–∏—Å—ã
systemctl stop fanslymotion-bot
systemctl stop fanslymotion-worker
systemctl stop fanslymotion-backend

# –û–±–Ω–æ–≤–∏—Ç—å –∫–æ–¥
cd /workspace/fanslymotion
git pull origin main

# –û–±–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
pip3 install -r requirements.txt --upgrade
pip3 install xformers==0.0.23

# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–∏—Å—ã
systemctl start fanslymotion-backend
systemctl start fanslymotion-worker
systemctl start fanslymotion-bot

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å
systemctl status fanslymotion-worker
```

## ‚öôÔ∏è –ù–æ–≤—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–î–æ–±–∞–≤—å—Ç–µ –≤ –≤–∞—à `.env` —Ñ–∞–π–ª (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –µ—Å—Ç—å –∑–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é):

```env
# –ù–æ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–∞—á–µ—Å—Ç–≤–∞
FPS=24                    # –ë—ã–ª–æ: 12
STEPS=40                  # –ë—ã–ª–æ: 24
ENHANCE_OUTPUT=True       # –ù–æ–≤–æ–µ: –ø–æ—Å—Ç–æ–±—Ä–∞–±–æ—Ç–∫–∞

# –ù–æ–≤—ã–µ —Ç–∞–π–º–∞—É—Ç—ã (–¥–ª—è –±–æ–ª–µ–µ –¥–æ–ª–≥–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏)
JOB_TIMEOUT=180          # –ë—ã–ª–æ: 60
RETRY_DELAY=60           # –ë—ã–ª–æ: 40
```

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

### 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤–µ—Ä—Å–∏—é –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
# Python
python -c "import diffusers; print(f'diffusers: {diffusers.__version__}')"
python -c "import torch; print(f'torch: {torch.__version__}')"

# xformers (–≤–∞–∂–Ω–æ!)
python -c "import xformers; print(f'xformers: {xformers.__version__}')"
```

### 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å GPU –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç
python -c "
import torch
print(f'CUDA available: {torch.cuda.is_available()}')
print(f'CUDA version: {torch.version.cuda}')
print(f'GPU: {torch.cuda.get_device_name(0)}')
print(f'TF32 enabled: {torch.backends.cuda.matmul.allow_tf32}')
"
```

### 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å API

```bash
# –¢–µ—Å—Ç health check
curl http://localhost:8000/health

# –î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å:
# {"status":"healthy","redis":"connected","queue_length":0,"max_queue_size":10}
```

### 4. –¢–µ—Å—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏

```bash
# –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ç–µ—Å—Ç–æ–≤–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –±–æ—Ç–∞
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ worker:
tail -f logs/worker.log

# –î–æ–ª–∂–Ω—ã –ø–æ—è–≤–∏—Ç—å—Å—è —Å–æ–æ–±—â–µ–Ω–∏—è:
# [OK] Enabled xformers memory efficient attention
# [OK] Enabled TF32 for faster computation
# [GENERATING] Video: 6s @ 1280x720
# [ENCODING] Using high-quality H.264 encoding...
```

## üêõ –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –ü—Ä–æ–±–ª–µ–º–∞: xformers –Ω–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è

```bash
# –í–∞—Ä–∏–∞–Ω—Ç 1: –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –¥–ª—è –≤–∞—à–µ–π –≤–µ—Ä—Å–∏–∏ CUDA
pip install xformers==0.0.23+cu121 --index-url https://download.pytorch.org/whl/cu121

# –í–∞—Ä–∏–∞–Ω—Ç 2: –°–æ–±—Ä–∞—Ç—å –∏–∑ –∏—Å—Ö–æ–¥–Ω–∏–∫–æ–≤ (–¥–æ–ª–≥–æ!)
pip install git+https://github.com/facebookresearch/xformers.git

# –í–∞—Ä–∏–∞–Ω—Ç 3: –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –±–µ–∑ xformers (–±—É–¥–µ—Ç –º–µ–¥–ª–µ–Ω–Ω–µ–µ)
# –ë–æ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–∞—Ä—É–∂–∏—Ç –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∏ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç —Ä–∞–±–æ—Ç—É
```

### –ü—Ä–æ–±–ª–µ–º–∞: Out of Memory

```python
# –í config.py —É–º–µ–Ω—å—à–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:
FPS = 18          # –≤–º–µ—Å—Ç–æ 24
STEPS = 30        # –≤–º–µ—Å—Ç–æ 40
```

–∏–ª–∏

```python
# –í svd/renderer.py –∏–∑–º–µ–Ω–∏—Ç—å:
decode_chunk_size=4  # –≤–º–µ—Å—Ç–æ 8
```

### –ü—Ä–æ–±–ª–µ–º–∞: –ú–µ–¥–ª–µ–Ω–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è

```bash
# 1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å xformers
python -c "from diffusers import StableVideoDiffusionPipeline; print('OK')"

# 2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å TF32 (—Ç–æ–ª—å–∫–æ –¥–ª—è RTX 30xx/40xx)
nvidia-smi --query-gpu=compute_cap --format=csv

# 3. –£–º–µ–Ω—å—à–∏—Ç—å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ
# –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ 720p –≤–º–µ—Å—Ç–æ 1080p
```

### –ü—Ä–æ–±–ª–µ–º–∞: –ö–∞—á–µ—Å—Ç–≤–æ —Ö—É–∂–µ —á–µ–º –æ–∂–∏–¥–∞–ª–æ—Å—å

```python
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ config.py:
class VideoConfig:
    FPS: int = 24          # –î–æ–ª–∂–Ω–æ –±—ã—Ç—å 24, –Ω–µ 12
    STEPS: int = 40        # –î–æ–ª–∂–Ω–æ –±—ã—Ç—å 40, –Ω–µ 24
    ENHANCE_OUTPUT: bool = True  # –î–æ–ª–∂–Ω–æ –±—ã—Ç—å True
```

## üìä –û–∂–∏–¥–∞–µ–º—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –î–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è | –ü–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è |
|----------|---------------|------------------|
| –ö–∞—á–µ—Å—Ç–≤–æ | 8/10 | 11/10 |
| FPS | 12 | 24 |
| –®–∞–≥–∏ | 24 | 40 |
| –í—Ä–µ–º—è (720p) | ~30s | ~40s |
| –í—Ä–µ–º—è (1080p) | ~60s | ~80s |
| VRAM (720p) | 18GB | 16GB |
| VRAM (1080p) | 22GB | 20GB |
| –ü–ª–∞–≤–Ω–æ—Å—Ç—å | –ó–∞–º–µ—Ç–Ω—ã–µ —Ä—ã–≤–∫–∏ | –ò–¥–µ–∞–ª—å–Ω–æ –ø–ª–∞–≤–Ω–æ |
| –†–µ–∑–∫–æ—Å—Ç—å | –°—Ä–µ–¥–Ω—è—è | –ö—Ä–∏—Å—Ç–∞–ª—å–Ω–∞—è |
| –î–µ—Ç–∞–ª–∏ | –•–æ—Ä–æ—à–∏–µ | –ü—Ä–µ–≤–æ—Å—Ö–æ–¥–Ω—ã–µ |

## üéØ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

### –î–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω—ã:
1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω xformers
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —É –≤–∞—Å >= 16GB VRAM
3. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ 720p –¥–ª—è –±–∞–ª–∞–Ω—Å–∞ –∫–∞—á–µ—Å—Ç–≤–∞/—Å–∫–æ—Ä–æ—Å—Ç–∏

### –î–ª—è –æ–±–ª–∞—á–Ω–æ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞:
1. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ RTX 4090 –∏–ª–∏ A100
2. –í–∫–ª—é—á–∏—Ç–µ –≤—Å–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
3. –ú–æ–∂–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å 1080p –±–µ–∑ –ø—Ä–æ–±–ª–µ–º

### –î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞:
1. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Docker Compose
2. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ (—Å–º. CLOUD_DEPLOYMENT.md)
3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ—Å—Ç–∞—Ä—Ç

## ‚úÖ –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–π —Å–ø–∏—Å–æ–∫

–ü–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —É–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ:

- [ ] –í—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ–±–Ω–æ–≤–ª–µ–Ω—ã
- [ ] xformers —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] Backend –∑–∞–ø—É—â–µ–Ω –∏ –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ /health
- [ ] Worker –∑–∞–ø—É—â–µ–Ω –∏ –≤–∏–¥–∏—Ç –æ—á–µ—Ä–µ–¥—å
- [ ] Bot –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ backend
- [ ] –¢–µ—Å—Ç–æ–≤–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –õ–æ–≥–∏ –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç –æ—à–∏–±–æ–∫
- [ ] GPU –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ (~80-90%)
- [ ] –ö–∞—á–µ—Å—Ç–≤–æ –≤–∏–¥–µ–æ —É–ª—É—á—à–∏–ª–æ—Å—å
- [ ] –í—Ä–µ–º—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø—Ä–∏–µ–º–ª–µ–º–æ

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏:
   ```bash
   # Windows
   cat storage/logs/*.log
   
   # Linux/Docker
   docker-compose logs -f worker
   ```

2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–∏—Å—Ç–µ–º—É:
   ```bash
   nvidia-smi
   redis-cli ping
   ```

3. –°–æ–∑–¥–∞–π—Ç–µ issue —Å:
   - –í–µ—Ä—Å–∏–µ–π Python
   - –í–µ—Ä—Å–∏–µ–π CUDA
   - –õ–æ–≥–∞–º–∏ –æ—à–∏–±–æ–∫
   - –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π GPU

---

**–ù–∞—Å–ª–∞–∂–¥–∞–π—Ç–µ—Å—å —É–ª—É—á—à–µ–Ω–Ω—ã–º –∫–∞—á–µ—Å—Ç–≤–æ–º! üé®‚ú®**

